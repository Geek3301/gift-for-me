$(function(){if(!pgf.class_styles)return;function W(e){return pgMakeSlug(e)}function q(e){var t=splitBracketsAware(e,":");return{class:t.pop(),prefix:0===t.length?"":t.join(":")+":"}}function G(t){var n=[],s=[];t.forEach(function(e){(e.component?n:s).push(e)}),t.splice(0,t.length),s.sort(function(e,t){return e.scopeParent&&!t.scopeParent?1:!e.scopeParent&&t.scopeParent?-1:e.name.localeCompare(t.name)}),n.forEach(function(e){t.push(e)}),s.forEach(function(e){t.push(e)})}window.PgPropStylesControl=function(){this.$element=$('<div class="pg-dm-style-control"></div>');function e(e,t){var n;t.stop||(n=c.find(".editing")).length&&(f(n.find("span"),n.find("button")),t.stop=!0)}function i(e,t){return e?e.display_name+` <i class="icon icon-right"></i>`:t?`<i class="icon icon-279"></i>`:null}var g,y,r,c=$('<div class="pg-dm-style-control-pills"></div>').appendTo(this.$element),f=(c.on("click",".style",function(e){e.preventDefault();var t=$(this),t=(t.attr("data-id"),parseInt(t.attr("data-idx")));pinegrow.classStyles.setCurrentStyle(r[t].style,!0,null,r[t])}),c.on("contextmenu",".style",function(e){e.preventDefault();var t=$(this),n=t.attr("data-id"),n=pinegrow.classStyles.findStyleByKey(n);return pinegrow.classStyles.showStyleContextMenu(n,t,e),!1}),c.on("click",".direct",function(e){e.preventDefault(),$(this).hasClass("editing")||pinegrow.classStyles.setCurrentStyleByKey(null,!0)}),c.on("click",".remove",function(e){e.preventDefault();var t=$(this).closest(".style").attr("data-id");return pinegrow.classStyles.removeStyleFromPgel(pinegrow.classStyles.findStyleByKey(t)),!1}),function(e,t){e.closest(".pg-dm-style-pill").removeClass("editing"),e.text("Inline"),e.removeAttr("contentEditable"),g&&g.destroy(),e.off("input.create"),t.off("click.create")}),d=(pinegrow.addEventHandler("on_esc_pressed",e),c.on("click",".create-new,.aaapg-dm-style-control-new",function(e){var n,p,t,s,u,h,l,o,a;if(e.preventDefault(),pinegrow.getCurrentProject())return n=$(this),p=n.closest(".pg-dm-style-pill"),h=pinegrow.selectedElements.getLastSelected(),l=pinegrow.classStyles.getStylesForPgel(h,!0),(t=l.length?l[l.length-1]:null)&&y&&(t=null),s=function(e,o){var a=p.find("span");if("true"==a.attr("contentEditable"))return!1;(y=void 0===e?!o&&pinegrow.classStyles.isUsingComponents():e)||p.addClass("not-component");function t(){g&&!g.classes_validation_done&&pinegrow.classStyles.classValidator.validateClasses(h.getClasses()).then(function(e){i=e,g&&g.setValidClasses(e),g&&(g.classes_validation_done=!0)})}var i=null;(g=new m(h,null,p,y)).onSelected=function(e){a.text(e)};if(g.onSwitchType=function(e){(y=e)?p.removeClass("not-component"):p.addClass("not-component"),y&&t(),a.get(0).focus()},y){if("undefined"==typeof PgDmDesignProviderForTailwind||!pgDmStore.isDesignEnabled(PgDmDesignProviderForTailwind))return void pinegrow.showAlert(`<p>Component styles require that Tailwind CSS Design panel is activated in the project. If you wish to use component styles go to the Design panel and click on the Activate button.</p>`,"Tailwind CSS Design panel must be active","Cancel","Go to the Design panel",function(){},function(){pinegrow.showUIPanel("pgdm",!1,!1,!0)});t()}p.addClass("editing"),a.text(""),a.attr("contentEditable","true"),a.get(0).focus();function n(){var s=a.text().trim(),e=y?s:W(s),t=(closeAllTooltips(100),pinegrow.classStyles.validateNameForANewStyle(s,null,o));if(t)pinegrow.showQuickError(t),setTimeout(function(){a.get(0).focus()},0);else{var n=async function(t){p.removeClass("editing"),g&&g.destroy(),d.forEach(function(e){e.usedAsScope=e===c}),y&&!i&&(i=await pinegrow.classStyles.classValidator.validateClasses(h.getClasses())),pinegrow.classStyles.createStyle(s,o,function(e){var n;t&&pinegrow.showQuickMessage(`Class <code>${t}</code> was added to the selected element.`),pinegrow.selectedElements.reselect(),i&&(n=[],$.each(i,function(e,t){!0!==t&&s!=="."+e&&n.push(e)}),n.length)&&pinegrow.showAlert(`<p>The following non-Tailwind classes were not added to the style <code>${s}</code>:</p><ul><li><code>${n.join("</code></li><li><code>")}</code></li></ul><p>These classes were left on the element.</p>`,"Only valid Tailwind CSS classes can be added to component styles",null,"Ok"),u&&pinegrow.showUIPanel("classstyles",!1,!1,!1)},c,i,t,y)},l=null;if(y&&!h.is(s)){if(!s.match(/^\.[a-z0-9\_\-]+$/i))return pinegrow.showAlert(`<p>The selected element ${h.getName({short:!0})} does not match the style selector <code>${s}</code>.</p><p>Are you sure you want to create this style?</p>`,"The selector does not match the selected element","Cancel","Yes, create it",function(){a.get(0).focus()},function(){n()});l=s.replace(".","")}pinegrow.classStyles.findDeletedStyleByKey(e)?pinegrow.showAlert(`<p>A style with the same key <code>${e}</code> was recently deleted but the whole project was not updated yet. The project needs to be updated first.</p>`,"The project needs to be updated","Cancel","Update project &amp; Create",function(){f(a,r)},function(){pinegrow.classStyles.updateProject(function(){n(l)})}):n(l)}}var r=p.find("button"),c=null,d=pinegrow.classStyles.findParentScopes(h),s=p.find("stylescope");addTooltip(s,"Select scope"),d.forEach(function(e){e.usedAsScope&&!c&&(c=e)}),s.on("click",function(e){e.preventDefault();var t=d.map(function(e){return{label:e.display_name,action:function(){c=e},check:c===e}});return t.splice(0,0,{label:"Select style scope",type:"header"},{label:"Global style",action:function(){c=null},check:null===c},{type:"divider"}),new CrsaContextMenu(t,s).showForElement(s),!1});a.on("keydown",function(e){switch(e.key){case"Enter":e.preventDefault(),n();break;case"aaaEscape":return e.preventDefault(),f(a,r),!1}}),a.on("input.create",function(e){g&&g.onUserValueChanged(a.text().trim())}),r.on("click.create",function(e){return n(),!1})},(u=0===pinegrow.classStyles.getStyles().length)?pinegrow.classStyles.showStyleTypeDialog().then(function(e){var t;null!==e&&(e=e,pinegrow.classStyles.setUsingComponents(e))&&(n.closest(".crsa-panel").find(".pg-dm-style-control-pills .icon-down"),t=n.closest(".crsa-panel").find(".pg-dm-style-control-new"),e?t.removeClass("not-component"):t.addClass("not-component"),y=e,setTimeout(function(){s()},0))}):(h=pinegrow.selectedElements.getLastSelected(),l=pinegrow.classStyles.findParentWithStyle(h),(o=pinegrow.classStyles.getStylesForPgel(h)).length||l||t?(a=[],t&&(a.push({type:"header",label:"Create a sub-style of class style:"}),a.push({label:t.getDisplayName(),action:function(){s(!1,t)},helptext:`Sub-style is used to create a variant of a class style. For example, sub-style Green can extend the class style Alert.`}),a.push({type:"divider"})),l&&(a.push({type:"header",label:"Add to parent style as sub-element variant:"}),a.push({label:l.style.getDisplayName(),info:l,action:function(){var e=this.info.style;pinegrow.classStyles.addToStyle(e,h,this.info.pgel),pinegrow.classStyles.setCurrentStyle(e,!0,null,this.info)},helptext:`All inline classes will be added to the parent style, prefixed with a custom selector variant so that only this element is styles.`}),a.push({type:"divider"})),o.length&&(a.push({type:"header",label:"Add to style:"}),o.forEach(function(e){a.push({label:e.getDisplayName(),action:function(){pinegrow.classStyles.addToStyle(e,h,h),pinegrow.classStyles.setCurrentStyle(e,!0)},helptext:`All inline classes will be copied to this style.`})}),a.push({type:"divider"})),a.push({label:"Create a new style...",action:function(){s()}}),h.hasChildren()&&(a.push({type:"divider"}),a.push({type:"header",label:"Options"}),a.push({label:"Include sub-elements",action:function(){var e=!("1"===pinegrow.getSetting(z,"0"));pinegrow.setSetting(z,e?"1":"0"),pinegrow.showMode("Include sub-elements",e)},check:"1"===pinegrow.getSetting(z,"0"),helptext:`Include classes of sub-elements, scoped with custom selector variants. For example, when creating a style <code>.card</code> on code <code style="display: block;
    margin: 5px 0;">div.text-white<br>&nbsp;&nbsp;&nbsp;&nbsp;p.text-sm</code> the style will include classes <code>text-sm<br>[&_p]:text-sm</code>.`})),new CrsaContextMenu(a,n).showForElement(n)):s()),!1;pinegrow.showQuickError("Styles require a project. Please open the page as a project first.")}),c.on("click",".add-style",function(e){e.preventDefault();function t(e){var t;pinegrow.classStyles.setUsingComponents(e)&&(t=n.closest(".crsa-panel").find(".pg-dm-style-control-new"),e?t.removeClass("not-component"):t.addClass("not-component"),pinegrow.showMode(e?"Component styles":"Class styles",!0))}var n=$(this),s=function(){p(this.data.key)},l=pinegrow.selectedElements.getLastSelected(),o=pinegrow.classStyles.getStylesForPgel(l),a=[{type:"header",label:"What type of style you wish to create?"},{label:"Component (CSS rules)",action:function(){t(!0)},helptext:`Create Tailwind CSS components that compile into one or more CSS rules that target elements with CSS selectors (for example, style <code>h1</code> affects all H1 elements in the project).`,check:pinegrow.classStyles.isUsingComponents()},{label:"Class style (class attribute)",action:function(){t(!1)},helptext:`Create styles that apply their classes directly to the class attribute of every element that uses the style.`,check:!pinegrow.classStyles.isUsingComponents()},{label:"Help me choose...",action:async function(){var e=await pinegrow.classStyles.showStyleTypeDialog();null!==e&&t(e)}},{type:"divider"}],i=function(e){var t;return e.children.length?(t=[],e.children.forEach(function(e){r(t,e)}),t):null},r=function(e,t,n){e.push({label:n?t.display_name:t.name,data:t,action:s,check:0<=o.indexOf(t),submenu:i(t)})},l=(a.push({type:"header",label:"Options"}),a.push({label:"Keep inline classes",action:function(){var e=!("1"===pinegrow.getSetting("class-styles-keep-inline","0"));pinegrow.setSetting("class-styles-keep-inline",e?"1":"0"),pinegrow.showMode("Keep inline classes that are not a part of the assigned style",e)},check:"1"===pinegrow.getSetting("class-styles-keep-inline","0"),helptext:`When assigning the class style, keep existing inline classes that are not a part of the assigned style`}),a.push({label:"Include sub-elements",action:function(){var e=!("1"===pinegrow.getSetting(z,"0"));pinegrow.setSetting(z,e?"1":"0"),pinegrow.showMode("Include sub-elements",e)},check:"1"===pinegrow.getSetting(z,"0"),helptext:`Include classes of sub-elements, scoped with custom selector variants. For example, when creating a style <code>.card</code> on code <code style="display: block;
    margin: 5px 0;">div.text-white<br>&nbsp;&nbsp;&nbsp;&nbsp;p.text-sm</code> the style will include classes <code>text-sm<br>[&_p]:text-sm</code>.`}),a.push({type:"divider"}),pinegrow.classStyles.getRecentlyUsed()),l=(l.length&&(a.push({type:"header",label:"Recently used"}),l.forEach(function(e){r(a,e,!0)}),a.push({type:"divider"})),a.push({type:"divider"}),a.push({label:"Show style manager",action:function(){pinegrow.showUIPanel("classstyles",!1,!1,!0)}}),pinegrow.classStyles.getStyles().filter(function(e){return null===e.parent&&!e.component}));return l.length&&(a.push({type:"header",label:"All styles"}),l.forEach(function(e){r(a,e)})),new CrsaContextMenu(a,n).showForElement(n),!1}),c.on("click","stylesubelement.multiple",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).closest(".pg-dm-style-pill"),n=t.attr("data-id"),s=pinegrow.classStyles.findStyleByKey(n),l=pinegrow.classStyles.getCurrentStyleContext(),o=[{type:"header",label:"Select sub-element style:"}];return l.all_states.forEach(function(e){d.state=e,o.push({label:d.formatStateWithSubelementForDisplay(),action:function(){pinegrow.classStyles.setCurrentStyle(s,!0,null,{style:s,state:e,whole_state:e,sel:d.getSubelementSelector(e),pgel:l.pgel,all_states:l.all_states})},check:e===(l?.state_whole||l?.state)})}),new CrsaContextMenu(o,t).showForElement(t),!1}),new PgActiveClassesForPgel_State),t=(this.show=function(e){this.showControl(),c.get(0).innerHTML="";var n="",s=pinegrow.classStyles.getCurrentStyle(),t=(pinegrow.classStyles.getCurrentStyleContext(),r=pinegrow.classStyles.getStylesForPgelIncludingSubelements(e)),l=t.map(function(e){return e.style}),o=!0,a=0,t=(t.forEach(function(e){var t=e.style;n+=`<div class="pg-dm-style-pill style ${s===t?"active":""} ${t.scopeParent?"with-scope":""} ${t.component?"component":"not-component"}" data-id="${t.key}" data-idx="${a++}">`,t.scopeParent&&(n+=`<stylescope>${i(t.scopeParent)}</stylescope>`),n+=t.name,e.state&&(d.state=e.state_whole||e.state,n+=`<i class="icon icon-right" style="opacity:0.35;color:inherit;"></i><stylesubelement class="${s===t&&1<e.all_states.length?"multiple":""}">${d.formatStateWithSubelementForDisplay()}</stylesubelement>`),n+=`<i class="remove icon icon-close"></i></div>`,o=!1}),pinegrow.classStyles.isUsingComponents());n+=`<div class="pg-dm-style-pill direct pg-dm-style-control-new ${null===s?"active":""} ${t?"":"not-component"}">`,o&&(n+=`<stylescope style="display:none;"></stylescope>`),n=n+`<span>Inline</span><i class="icon icon-Editable create-new"></i><button style="" class="pg-button">Ok</button></div>`+'<div class="add-style"><i class="icon icon-down"></i></div>',c.get(0).innerHTML=n,addTooltip(c.find(".create-new"),`Create a new ${pinegrow.classStyles.getNameForStyleType(null,l.length,!1)}.`),addTooltip(c.find(".remove"),`Remove from the selected element.`),addTooltip(c.find(".direct button"),`Click or ${pgShowKbd("Enter")} to create, ${pgShowKbd("Esc")} to cancel.`)},!0),p=(this.showControl=function(){t||(pg$Show(this.$element),t=!0)},this.hideControl=function(){t&&(pg$Hide(this.$element),t=!1)},function(e){var t=pinegrow.classStyles.findStyleByKey(e);t?pinegrow.classStyles.assignStyle(t,null,"1"===pinegrow.getSetting("class-styles-keep-inline","0")):pinegrow.showQuickError(`Style <b>${e}</b> does not exist.`)});this.destroy=function(){pinegrow.removeEventHandler("on_esc_pressed",e)}};function n(){function d(e){for(var t=[],n={},s=C(e.key),l=0;l<s.length;l++){var o=s[l],o=T(o);o&&o.getClasses().forEach(function(e){v(t,e,n,y)})}return t}function o(t,n){pinegrow.getAllPages().forEach(function(e){L(e)&&R(e,t,n)})}function l(e){return e=E&&E.state&&e.indexOf(E.state+":")<0?E.state+":"+e:e}function a(e){return E?.pgel||e}async function f(e,t,n,s,l,o,a,i){var r,c,d,p=[],u=(i=i||e,new PgActiveClassesForPgel_State);if(l?p=l:e&&(p=m.getStylesForPgel(e).length?j(e):e.getClasses().slice(0)),n&&(r=[],p.forEach(function(e){(n[e]?r:s).push(e)}),p=r),o){for(var h=await pinegrow.classStyles.classValidator.validateClasses(p),g=[],y=0;y<p.length;y++)(h[p[y]]?g:s).push(p[y]);p=g}if(i!==e&&(c=e.getUniqueSelector(i,p))&&(d=pinegrow.classStyles.getCustomVariantForSelector(c),p=p.map(function(e){return u.moveRelevantStatesToSubelementStateForClass(d+":"+e)})),t){var f=[];if(e.walk(function(e){if(e.isElement){var t=j(e);if(t.length)for(var n=0;n<t.length;n++)f.indexOf(t[n])<0&&f.push(t[n])}return!0}),o){for(h=await pinegrow.classStyles.classValidator.validateClasses(f),g=[],y=0;y<f.length;y++)h[f[y]]&&g.push(f[y]);f=g}f.length&&e.walk(function(e){if(e.isElement){var t=j(e);if(t.length){var n=e.getUniqueSelector(i,f);if(n){for(var s=pinegrow.classStyles.getCustomVariantForSelector(n),l=[],o=0;o<t.length;o++)0<=f.indexOf(t[o])?p.push(u.moveRelevantStatesToSubelementStateForClass(s+":"+t[o])):l.push(t[o]);B(e,l),a.add(e)}}}return!0})}return p}function i(e,t,n){var s,l=m.getStylesForPgel(e),o=(l.indexOf(t)<0&&l.push(t),l=[t],[]);n&&(s=t.getClasses(),(e.hasAttribute(g)?j(e):e.getClasses()).forEach(function(e){s.indexOf(e)<0&&o.push(e)})),o.length&&e.setAttribute(w,o.join(" ")),e.setAttribute(g,l.map(function(e){return e.key}).join(" ")),t.count++,b(e)}function p(n,s,l,o,a){var i=!1,r=new RegExp(`^${escapeRegExp(s)}(.|$)`),c=s.split("."),d=new PgClassStyle(s,!0).isClassSelector();return n.sourceNode.walk(function(t){var e;return t.isElement&&(o?l&&t.is(s)&&(a.forEach(function(e){O(t,e)}),d&&U(t,d),i=!0):(e=t.getAttribute(g))&&(e=e.trim()).match(r)&&((e=e.split(".")).splice(c.length-1,e.length-c.length+1),0===e.length?t.removeAttribute(g):t.setAttribute(g,e.join(".")),l||t.removeAttribute("class"),b(t,n),i=!0)),!0}),i}function u(){0===pinegrow.getAllPages().length&&isApp()&&h&&h.save()}function I(e){var t,n="!"===e.charAt(0)?(t=e).substr(1):(t="!"+e,e);return{normal:n,important:t}}function H(){return 0<m.getStyles().length}function s(){var s,e;h&&(s=new WeakMap,A.forEach(function(e){e.destroy()}),A=[],x={},(e=h.findOne("> classstyles"))&&e.find("classstyle").forEach(function(e){var t,n=new PgClassStyle(e);A.push(n),x[n.key]=n,s.set(e,n),"classstyle"===e.parent.tagName&&(t=s.get(e.parent),n.key.startsWith(t.key+":")?n.setScopeParent(t):n.setParent(t),n.level=t.level+1,n.updateKeyAndDisplayName())}),M(!0),m.setCurrentStyleByKey(P?P.key:null),pinegrow.dispatchEvent("on_class_styles_updated_from_db"),s=null)}var m=this,h=null,g="data-pg-class-style",w="data-pg-class-style-inline",S="pg-placeholder-class",V=new PgDelayedTasks,y=(this.classValidator=null,{}),n=!1,K=(this.isPlaceholderClass=function(e){return e&&e.endsWith(S)},this.getPlaceholderClassForVariant=function(e){return e?(e.endsWith(":")||(e+=":"),e+S):S},this.getCustomVariantForSelector=function(e){return`[&_${e.replace(/_/g,"\\_").replace(/ /g,"_")}]`},this.addClassToPropMap=function(e){$.each(e,function(e,t){y[e]=t})},this.getStyleForStyleNode=function(e){for(var t=0;t<A.length;t++)if(A[t].db_node===e)return A[t];return null},this.getDBNodeForAllStyles=function(){return h.findOne("> classstyles")},this.canUseComponents=function(e){e=e||{reason:""};var t=pgDmStore.getActiveDesignProvider();return t&&t instanceof PgDmDesignProviderForTailwind?!t.useExternalBuild()||(e.reason="Component styles do not work with the external Tailwind CSS build process. They only work with the internal compiler.",!1):(e.reason="Component styles require activated Tailwind CSS Design panel.",!1)},this.isUsingComponents=function(){return n},this.setUsingComponents=function(e){var t={};if(e&&!this.canUseComponents(t))return pinegrow.showAlert(`<p>Component styles can not be used in this project. ${t.reason}</p>`,"Component styles can not be used",null,"Got it"),!1;n=e;t=pinegrow.getCurrentProjectInfo();return t.setSetting("class-styles-components",e?"1":"0"),t.save(),!0},this.getNameForStyleType=function(e,t,n){var s=e?e.component:this.isUsingComponents(),l="style";return t&&!s&&(l="sub-"+l),n&&(l+="s"),l},this.removeAllInlineTailwindClasses=async function(e,t){function n(e){return e.isElement&&j(e).forEach(function(e){r.indexOf(e)<0&&r.push(e)}),!0}function s(e){for(var t=0;t<r.length;t++)if(!canMakeChange(e,"remove_class",r[t]))return c=!1}var l,o,a=pinegrow.getCollectionForElement(e),i=new PgCollection,r=[],c=(a.forEachElement(function(e){t?e.walkSelfAndChildren(n):n(e)}),!0);a.forEachElement(function(e){c&&(t?e.walkSelfAndChildren(s):s(e))}),c&&(pinegrow.showQuickMessage("Gathering classes... Please wait..."),l=await pinegrow.classStyles.classValidator.validateClasses(r),o=function(t){return t.isElement&&j(t).slice(0).forEach(function(e){l[e]&&(U(t,e),i.add(t))}),!0},a.forEachElement(function(e){t?e.walkSelfAndChildren(o):o(e)}),i.getLength()?(pinegrow.changeManager.didChange(i,"Remove Tailwind CSS classes"),pinegrow.showQuickMessage("Tailwind CSS classes were removed. Undo to cancel.")):pinegrow.showQuickMessage("Nothing to do."))},function(e){return"!"===e.charAt(0)?e.substring(1):e}),v=function(e,t,n,s,l){s=s||y;var o=q(t),a=s[K(o.class)]||null,i=(a&&(n[a=o.prefix+a]&&n[a]!==t&&0<=(i=e.indexOf(n[a]))&&(e.splice(i,1),l)&&l.indexOf(n[a])<0&&l.push(n[a]),n[a]=t),e.indexOf(t));i<0&&e.push(t)},C=(this.addClassToListHelper=v,function(e){for(var t=e.split("."),n=[],s=null,l=0;l<t.length;l++)s=(0===l?"":s+".")+t[l],n.push(s);return n}),b=this.applyStylesOnPgel=function(e,t,n){var s=e.getAttr(g);if(!s)return d=!1,e.hasAttribute(g)&&(e.removeAttribute(g),d=!0),e.hasAttr(w)&&((c=e.getAttr(w))?e.setAttr("class",c):e.removeAttribute("class"),e.removeAttribute(w),d=!0),d;for(var l=[],o={},a=C(s.trim()),i=0;i<a.length;i++){var r=a[i],r=T(r);r&&(r.getClasses().forEach(function(e){v(l,e,o,y)}),n)&&r.count++}(c=e.getAttr(w))&&splitBracketsAware(c," ").forEach(function(e){e.length&&v(l,e,o,y)});var c,d=e.getAttr("class")||"",s=l.join(" ");return d!==s&&(s?e.setAttr("class",s):e.removeAttr("class"),!0)},R=this.applyStylesOnPage=function(t,n,s,l){var o=!1;return t.sourceNode.walk(function(e){return e.isElement&&e!==s&&(e.hasAttr(w)||e.hasAttr(g))&&(!n||0<=m.getStylesForPgel(e).indexOf(n))&&(o=b(e,t,l)||o),!0}),o},r=(this.resetUsageCounts=function(){A.forEach(function(e){e.count=0})},this.rememberUsageCounts=function(){A.forEach(function(e){e.setUsageCount(e.count)})},[]),_=this.triggerStylesChanged=function(e,t,n){var s=!1;e.forEach(function(e){r.indexOf(e)<0&&r.push(e),s=s||e.component}),n=n||{},t?V.run("classStylesTriggerChanged",function(){pinegrow.dispatchEvent("on_class_styles_changed",null,r,n),r=[]},100):(V.cancel("classStylesTriggerChanged"),pinegrow.dispatchEvent("on_class_styles_changed",null,r,n),r=[]),s&&pgDmStore.update()},k=this.styleWasChanged=function(e,t,n,s,l){(n=n||P)&&!n.component?e?!t&&n?(b(e),c=e):b(e):o(P):e&&b(e),n&&_(l||[n],!0,s),h.is_changed=!0},P=null,c=null,E=null,A=[],x={},T=function(e){return e&&x[e]||null},D=(this.getStyles=function(){return A},this.findStyleByKey=function(e){return T(e)},this.findStyleByName=function(e,t){e=e.toLowerCase();for(var n=0;n<A.length;n++)if(A[n].name.toLowerCase()===e&&(!t||A[n].parent===t))return A[n];return null},this.findDeletedStyleByKey=function(e){var t=h.getDBNode("classstyles");return t?t.findOne(`deleted[key="${e}"]`):null},this.getComponentStyles=function(){for(var e=[],t=0;t<A.length;t++)A[t].component&&e.push(A[t]);return e},this.getNonComponentStyles=function(){for(var e=[],t=0;t<A.length;t++)A[t].component||e.push(A[t]);return e},this.setLastLocked=function(e){0},this.setLastExpanded=function(e){0},this.validateNameForANewStyle=function(e,t,n){var s,l=t?t.component:this.isUsingComponents();return e?l||e.match(/^[a-z0-9\s_]+$/i)?this.findStyleByName(e,n)?`Style ${e} already exists!`:(l=l?e:W(e),n&&(l=n.key+"."+l),!(s=this.findStyleByKey(l))||t&&s===t?null:`Style with the id ${l} already exists!`):`Style name can only contain letters, numbers, _ and spaces.`:"Style name can not be empty."},this.findParentScopes=function(e){for(var t=[],n=e.parent;null!==n;){var s=m.getStylesForPgel(n);s.length&&t.push(s[0]),n=n.parent}return t},this.findParentWithStyle=function(e){for(var t=e.parent;null!==t;){var n=m.getStylesForPgel(t);if(n.length)return{style:n[0],pgel:t};t=t.parent}return null},this.getStyleScope=function(e){var t=e.key.split(":");return 1<t.length?this.findStyleByKey(t[0]):null},this.addToStyle=async function(d,p,u){return new Promise(function(c){pinegrow.requireProjectDB(async function(e){var t=pinegrow.getCollection(),n=[],s="1"===pinegrow.getSetting(z,"0"),l=await f(p,s,null,n,null,d.component,t,u);if(l.length){for(var o=new PgActiveClassesForPgel_State,a=(B(p,n),[]),i={},r=0;r<d.classes.length;r++)v(a,d.classes[r],i,y);for(r=0;r<l.length;r++)v(a,o.moveRelevantStatesToSubelementStateForClass(l[r]),i,y);d.setClasses(a),k(p,!1,d),pinegrow.changeManager.didChange(t,"Add to style "+d.getDisplayName(),{})}c()})})},this.setStyleClasses=async function(s,l){return new Promise(function(n){pinegrow.requireProjectDB(async function(e){var t=new PgCollection;s.setClasses(l),t.add(s.db_node),k(null,!1,s),pinegrow.changeManager.didChange(t,"Edit style "+s.getDisplayName(),{}),n()})})},this.createStyle=function(r,c,d,p,u,h,g,y){pinegrow.requireProjectDB(async function(e){var t=pinegrow.selectedElements.getLastSelected(),n=pinegrow.getCollection(),s=g,l=(void 0===s&&(s=!c&&m.isUsingComponents()),[]),o="1"===pinegrow.getSetting(z,"0"),o=await f(t,o,u,l,y,s,n),a=new PgClassStyle(r,s),o=(a.classes=o,a.component=s,c&&a.setParent(c,!0),p&&a.setScopeParent(p),a.updateKeyAndDisplayName(),A.push(a),x[a.key]=a,e.getDBNode("classstyles")),i=e.createNode("classstyle",{name:a.name,key:a.key,class:a.classes.join(" ")},!1);a.db_node=i,a.setExpanded(!0),a.setComponent(s),c?(c.db_node.append(i),a.level=c.level+1):p?(p.db_node.append(i),a.level=p.level+1):o.append(i),e.changed(new PgCollection(o),{source:"class_styles"}),M(!0),_([a]),t.removeAttr(w),h&&l.indexOf(h)<0&&l.push(h),a.component&&(l.length?t.setAttribute("class",l.join(" ")):t.removeAttr("class")),s?(pinegrow.changeManager.didChange(n,"Create style "+r,{}),pinegrow.classStyles.setCurrentStyle(a,!0)):m.assignStyle(a,"Create style "),d&&d(a)})},[]),Q=4,F=(this.getRecentlyUsed=function(){var n=[];return D.forEach(function(e){var t=T(e);t&&!t.component&&n.push(t)}),n},this.assignStyle=function(t,e,n){var s;if(t.component)return s=pinegrow.selectedElements.getLastSelected(),(l=t.isClassSelector())?((new PgApi).addClass(null,[l],null,t.getClasses(),"inline"),void pinegrow.showQuickMessage(`Class <code>${l}</code> was added to the selected element.`)):void(s&&this.isStyleOnPgel(s,t)?pinegrow.showAlert(`<p>This component style with the CSS selector <code>${t.getSelector()}</code> already targets the selected element.`,"Style already targets the element",null,"Got it"):pinegrow.showAlert(`<p>This component style affects all elements that match its CSS selector <code>${t.getSelector()}</code>. Therefore, it can not be added to the element by just clicking a button.</p><p>You have two ways of adding this style to the element:</p><ul><li>Change the name / selector of the style so that if targets the element.</li><li>Change the selected element tag name, class or other property, so that it matches the selector.</li></ul>`,"Component style can not be added to the element directly",null,"Got it"));var l=D.indexOf(t.key),o=(0<=l&&D.splice(l,1),Q<=D.length&&D.pop(),D.unshift(t.key),pinegrow.getCollection());o.getLength()&&pinegrow.makeChanges(o,(e||"Assign style ")+t.display_name,function(){o.forEachElement(function(e){i(e,t,n)})}),pinegrow.classStyles.setCurrentStyle(t,!0)},this.removeStyleFromPgel=function(r,c){if(r.component){var e=r.isClassSelector();if(e){var t=pinegrow.selectedElements.getLastSelected();if(t&&t.hasClass(e))return t=new PgApi,pinegrow.showQuickMessage(`Class <code>${e}</code> was removed from the selected element.`),c?(t.addClass(null,r.getClasses(),null,[e],"inline"),pinegrow.showQuickMessage(`Style classes were added to the selected element.`)):t.removeClass(null,[e],null,"inline"),void(r===P&&this.setCurrentStyleByKey(null,!0))}pinegrow.showAlert(`<p>This component style affects all elements that match its CSS selector <code>${r.getSelector()}</code>. Therefore, it can not be removed from the element by just clicking a button.</p><p>You have two ways of removing the style from the element:</p><ul><li>Change the name / selector of the style.</li><li>Change the selected element tag name, class or other property, so that it doesn't match the selector.</li></ul>`,"Component style can not be removed from the element",null,"Got it")}else{var n=pinegrow.getCollection(),d=null;pinegrow.makeChanges(n,"Remove style "+r.display_name,function(){n.forEachElement(function(e,t,n){var s,l,o,a,i=m.getStylesForPgel(e);e=e,s=r,o=c,0<=(a=(l=i).indexOf(s))&&l.splice(a,l.length-a),l.length?e.setAttribute(g,l[l.length-1].key):e.removeAttribute(g),o?e.removeAttribute(w):e.removeAttribute("class"),0<s.count&&s.count--,b(e),t===n-1&&(d=i.length?i[i.length-1]:null)})}),r===P?m.setCurrentStyleByKey(d,!0):m.setCurrentStyleByKey(P,!0)}},this.overrideCSSRuleWithComponentStyle=async function(y,f){return new Promise(function(t,e){function n(e){f&&console.error(e)}y=y.replace(/> /g,">").replace(/[^ ]+>/g," >");var s=splitQuotesAware(y,",").map(function(e){return e&&e.trim()}).filter(function(e){return!!e});if(1<(s=s.map(function(e){return splitBracketsAware(e," ").map(function(e){return e&&e.trim()}).filter(function(e){return!!e})})).length)return n(`The selector <code>${y}</code> is too complex for me to figure it out.`),t(null),!1;for(var l=[],o=[],a="",i=0;i<s.length;i++){if(a.length&&(a+=", "),!(c=splitBracketsAware(s[i][0],":"))[0])return n(`<code>${s[i][0]} is a pure pseudo selector without tag name or class.`),t(null),!1;var r=[a=c[0]];1<r.length&&(a=r.shift(),l.push(`[&\\_\\_${r.join("\\_\\_")}]`)),(o=splitBracketsAware(a,".")).length&&(a=o[0]?o.shift():(o.shift(),"."+o.shift())),o.length&&l.push(`[&.${o.join(".")}]`);for(i=1;i<c.length;i++)l.push(c[i]);break}for(i=1;i<s[0].length;i++){var c,d=s[0][i];if(!(c=splitBracketsAware(d,":"))[0])return n(`<code>${d} is a pure pseudo selector without tag name or class.`),t(null),!1;var p=`[&_${c[0].replace(/ /g,"_")}]`;if(1<c.length)for(var u=1;u<c.length;u++)p+=":"+c[u];l.push(p)}var h,g=m.findStyleByKey(a);return g&&!g.component?(n(`The style <code>${a}</code> already exists, but it is not a component.`),t(null),!1):(h=l.join(":"),f?void t(a+` - `+h):g?(0===l.length||g.hasVariant(h)||(g.addClass(h+":"+S),k(null,!1,g)),t(g),g):void m.createStyle(a,null,function(e){e?t(e):(n(`Unable to create the style <code>${a}</code>`),t(null))},null,null,null,!0,h?[h+":"+S]:null))})},pgIsDev()&&async function(){for(var e=["h1","h1 small","a:hover","a:hover i","h1,h2",".entry-content .image-left",".wp-block-navigation-item__content",".nav-item.active:hover li","h1.lead","p.lead span","h2.lead.bold > small"],t=0;t<e.length;t++){var n=await m.overrideCSSRuleWithComponentStyle(e[t],!0);console.log(`overrideCSSRuleWithComponentStyle: ${e[t]} -> `+n)}}(),this.matchComponentStylesForPgel=function(e,t){t=t||[];for(var n=0;n<A.length;n++)A[n].component&&A[n].isMatchForPgel(e)&&t.push(A[n]);return t},this.addStyleToMatchingElements=function(t,e){var n=new PgCollection,s=d(t),l={};return s.forEach(function(e){l[e]=!0}),0===s.length?(pinegrow.showQuickError("The style does not have any properties."),null):(e.sourceNode.walk(function(e){return e.isElement&&function(e){var t=e.getClasses();if(t.length!==s.length)return!1;for(var n=0;n<t.length;n++)if(!l[t[n]])return!1;return!0}(e)&&0===m.matchComponentStylesForPgel(e).length&&n.add(e),!0}),0===n.getLength()?(pinegrow.showQuickError("No elements with the same properties as the style were found."),null):(pinegrow.makeChanges(n,`Add ${t.display_name} to matched`,function(){n.forEachElement(function(e){i(e,t)})}),pinegrow.showQuickMessage(`Style ${t.display_name} was added to ${n.getLength()} element${1<n.getLength()?"s":""} on the page.`),n))},this.deleteStyle=function(o,a){var i=new PgCollection(o.db_node),r=[],c=[];pinegrow.requireProjectDB(function(l){pinegrow.makeChanges(o.db_node.getPage(),"Delete style "+o.display_name,function(){var n=l.getDBNode("classstyles"),s=function(e){var t=l.createNode("deleted",{key:e.key},!1);a&&t.setAttribute("leave-classes"),e.component&&t.setAttribute("component"),t.setAttribute("class",e.getClasses().join(" ")),n.append(t),i.add(t),i.add(e.db_node),c.push(e),e.children.forEach(s),r.push(e)};s(o),l.changed(i,{source:"class_styles"}),o.component&&!1||pinegrow.getAllPages().forEach(function(e){var t;L(e)&&p(e,o.key,a,o.component,o.getClasses())&&(t=e.findFrameworkOfType("tailwind"))&&t.classTracker.inspectPage(e)}),c.forEach(function(e){var t=A.indexOf(e);0<=t&&A.splice(t,1),e.remove()}),M(!1)}),_(r),u(),pgDmStore.update(),pinegrow.showQuickMessage(`Style <b>${o.display_name}</b> was deleted. Use Undo to restore. Update the whole project to apply to all pages.`)}),pinegrow.selectedElements.reselect()},this.duplicateStyle=function(n,o,a,i,e){var r,c=[];return pinegrow.makeChanges(n.db_node,`Duplicate style `+n.display_name,function(){var s=new PgCollection,e=h.getDBNode("classstyles"),t=(r=new PgClassStyle(o,n.component),"as_substyle"===i?(r.setParent(n.parent),r.classes=n.classes.slice(0)):(r.setParent(null),r.classes=d(n)),r.component=n.component,r.updateKeyAndDisplayName(),r.updateToNode(h),(r.parent?r.parent.db_node:e).append(r.db_node),s.add(r.db_node.parent),s.add(r.db_node),A.push(r),c.push(r),r),l=function(e,t){var n=new PgClassStyle(e.name,e.component);n.classes=e.classes.slice(0),n.setParent(t),n.updateKeyAndDisplayName(),n.updateToNode(h),e.children.forEach(function(e){l(e,n)}),t.db_node.append(n.db_node),s.add(n.db_node),A.push(n),c.push(n)};"with_substyles"===a&&n.children.forEach(function(e){l(e,t)}),h.changed(s,{source:"class_styles"}),M(!0),u()}),_(c),e&&e(r),r},this.moveStyleRelativeToStyle=function(o,a,i){pinegrow.requireProjectDB(function(e,t){var n=new PgCollection(o.db_node),s=A.indexOf(o),l=(0<=s&&A.splice(s,1),A.indexOf(a));switch(i){case"top":break;case"bottom":l++}if(l<0&&(l=A.length,a=null),l=Math.min(l,A.length),A.splice(l,0,o),a)switch(i){case"top":o.db_node.insertBefore(a.db_node);break;case"bottom":o.db_node.insertAfter(a.db_node)}else e.getDBNode("classstyles").append(o);e.changed(n,{source:"class_styles"}),pinegrow.selectedElements.reselect(),_([o])})},this.renameStyle=function(a,i,r){var c=new PgCollection(a.db_node);pinegrow.requireProjectDB(function(e,t){var n=a.key,s=(a.name=a.display_name=i,[]),l=function(e){e.updateKeyAndDisplayName(),e.db_node.setAttr("key",e.key),e.db_node.setAttr("name",e.name),s.push(e),e.children.forEach(l)},o=(l(a),M(!0),new RegExp(`^${escapeRegExp(n)}(.|$)`,"i"));a.count=0,t.forEachEditableFile(function(e,t,n){pinegrow.undoManager.getActiveHistory().ignore(function(){n.skip_refresh=!0,e.sourceNode.walk(function(e){var t;return e.isElement&&(t=e.getAttr(g))&&t.match(o)&&(t=t.replace(o,a.key+`$1`),e.setAttribute(g,t),n.changed=!0,n.save=!0,a.count++),!0})}),t(e,n)},function(){m.rememberUsageCounts(),pinegrow.undoManager.getActiveHistory().changeDone(`Rename style to `+a.display_name,null,"class_styles",{},"Project (no undo)"),e.changed(c,{source:"class_styles"}),isApp()&&e.save(),pinegrow.selectedElements.reselect(),_(s),r&&r()},"Renaming style...")})},new PgActiveClassesForPgel_State),N=(this.setCurrentStyle=function(e,t,n,s){P=e,E=s,t&&pinegrow.getCollection().forEachElement(function(e){(s?.pgel||e)._rememberCurrentClassStyle=P||"direct"}),s?.state&&(l=pinegrow.getSelectedPage(),F.state=s.state,i=null,o=pinegrow.findFrameworkByType("tailwind"),a=F.containsSubelement())&&((c=F.hasNonSubelementStates(a))?(o&&(i=(r=o.twGetClassInfo(c+":dummy",null,!0)).size,c=r.whole_without_size),E.state_whole=F.state,E.state=F.makeSureSubelementStateHasBrackets(a),pinegrow.dispatchEvent("on_current_pseudo_state_changed",pinegrow.getSelectedPage(),[c])):(o&&(i=(r=o.twGetClassInfo(a+":dummy",null,!0)).size),pinegrow.dispatchEvent("on_current_pseudo_state_changed",pinegrow.getSelectedPage(),[])),pinegrow.setCurrentDeviceSize(pinegrow.getDeviceSizeDefByName(i||"all"),l,l.activeView));var l,o,a,i,r,c={source:n||"none"};pinegrow.dispatchEvent("on_current_class_style_changed",pinegrow.getSelectedPage(),P,c)},this.setCurrentStyleByKey=function(e,t,n,s){this.setCurrentStyle(T(e),t,n,s)},this.getCurrentStyle=function(){return P},this.getCurrentStyleContext=function(){return E},this.getStylesForPgel=function(e,t){var n=[],s=e.getAttr(g);return s&&C(s).forEach(function(e){var t=T(e);t&&n.push(t)}),t||this.matchComponentStylesForPgel(e,n),n},this.getStylesForPgelIncludingSubelements=function(t){var n=this.getStylesForPgel(t).map(function(e){return{style:e,state:null,pgel:t,all_states:[]}}),e=this.findParentWithStyle(t);if(e&&function(e){for(var t=0;t<n.length;t++)if(n[t].style===e)return t;return-1}(e.style)<0){var s=e.style.getAllSubelementSelectors();if(s.length){for(var l=[],o=-1,a=0;a<s.length;a++)t.is(s[a].sel,e.pgel)&&l.indexOf(s[a].state)<0&&(l.push(s[a].state),E)&&(E.state_whole||E.state)===s[a].state&&(o=a);if(l.length){if(l.sort(function(e,t){return e.length-t.length}),o<0){for(a=0;a<s.length;a++)if(s[a].state===l[0]){o=a;break}o<0&&(o=0)}n.push({style:e.style,state:s[o].state,state_whole:s[o].state,sel:s[o].sel,pgel:e.pgel,all_states:l})}}}return n},this.getInlineClassesForPgel=function(e){return splitBracketsAware(e.getAttr(N(e))||""," ").filter(function(e){return 0<e.length})},this.getPgelStyleWithClass=function(e,t){var n=e.getPage();if(L(n)){var s=pinegrow.classStyles.getStylesForPgel(e);if(s.length){var l=null;if(0<=pinegrow.classStyles.getInlineClassesForPgel(e).indexOf(t))return"inline";for(var o=s.length-1;0<=o;o--)if(0<=s[o].getClasses().indexOf(t)){l=s[o];break}return l}}},this.ensureStyleWithClassIsSelected=function(e,t){var n=this.getPgelStyleWithClass(e,t);(n="inline"===n?null:n)!==pinegrow.classStyles.getCurrentStyle()&&pinegrow.classStyles.setCurrentStyle(n,!0,"click_on_class")},this.isStyleOnPgel=function(e,t){return 0<=this.getStylesForPgel(e).indexOf(t)},this.wouldComponentCauseError=async function(e,t){var n=pgDmStore.getActiveDesignProvider();if(n&&n instanceof PgDmDesignProviderForTailwind)try{var s=e.getClasses();return t&&(s=s.concat(t)),await(await n.withEngine()).validateComponent(e.getSelector(),s),!1}catch(e){return e}return!0},this.getPgelsWithStyleOnPage=function(t,e){e=e||pinegrow.getSelectedPage();var n=[];return e&&(t.component?n=e.sourceNode.find(t.getSelector()):e.sourceNode.walk(function(e){return e.isElement&&m.isStyleOnPgel(e,t)&&n.push(e),!0})),n},this.editStyleSource=function(l,e){var n=new PgDelayedTasks,o=0,t={title:"Edit style "+l.getDisplayName(),winId:"editClassStyle"+Math.random(),pin:!1,focus:!1,key:"edit-class-style-source",jade:!1,lint:!1,editable:!0,copy:!0,filter_copy:function(e){return i(e)},handleSelect:!1,custom:!0,$target:e,on_change:function(e){e=i(e);var t=splitBracketsAware(e," ");o++,n.run("update",function(){s(t,o)},l.component?500:100)}},a=!0,s=async function(e,t){if(l.component){var n=await pinegrow.classStyles.classValidator.validateClasses(e);if(t!==o)return;var s=!0;if($.each(n,function(e,t){t||(s=!1)}),!s)return a=!1,void r.get$Title().html("Edit style "+l.getDisplayName()+" - Invalid classes, not saved").css({color:"white"}).parent().css({background:"var(--pg-orange)"});a||(a=!0,$(".quick-message-error").remove(),pinegrow.showQuickMessage("All classes are fine now.",null,!0),r.get$Title().html("Edit style "+l.getDisplayName()).css({color:""}).parent().css({background:""}))}pinegrow.classStyles.setStyleClasses(l,e)},i=function(e){return e=(e=splitBracketsAware(e,"\n").map(function(e){return e.trim()}).filter(function(e){return!!e}).join(" ")).replace(/\s\s+/g," ")},r=pgQuickWindowManager.getWindow(t.winId),t=(r=r||new PgQuickCodeEdit(null,t).win,l.getClasses()),c=pinegrow.getSelectedPage(),c=(t=c?c.classSorter(t):t).join("\n");r.view.setCustomCode(c)},this.updateUsageCounts=function(n){pinegrow.requireProjectDB(function(e,t){m.resetUsageCounts(),t.forEachEditableFile(function(t,e,n){m.getStyles().forEach(function(e){e.component&&(e.count+=t.sourceNode.find(e.getSelector()).length)}),t.sourceNode.walk(function(e){return e.isElement&&m.getStylesForPgel(e,!0).forEach(function(e){e.count++}),!0}),e(t,n)},function(){m.rememberUsageCounts(),n&&n()},"Updating usage counts...")})},this.updateProject=function(n){pinegrow.requireProjectDB(function(e,t){m.resetUsageCounts();var l=e.getDBNode("classstyles").find("deleted");t.forEachEditableFile(function(n,e,s){var t;l.forEach(function(e){var t=e.getAttribute("key");t&&(s.changed=p(n,t,e.hasAttribute("leave-classes"),e.hasAttribute("component"),splitBracketsAware(e.getAttribute("class")||""," "))||s.changed)}),m.getStyles().forEach(function(e){e.component&&(e.count+=n.sourceNode.find(e.getSelector()).length)}),s.changed=m.applyStylesOnPage(n,null,null,!0)||s.changed,s.changed&&(s.save=!0,t=n.findFrameworkOfType("tailwind"))&&t.classTracker.inspectPage(n),e(n,s)},function(){m.rememberUsageCounts(),l.forEach(function(e){e.remove()}),isApp()&&t.db.save(),pgDmStore.update(),n&&n()},"Updating styles...")})},this.getCurrentStyleForPgel=function(e){var t;return e&&(!e._rememberCurrentClassStyle||"direct"!==e._rememberCurrentClassStyle)&&(t=m.getStylesForPgel(e)).length?e._rememberCurrentClassStyle&&0<=t.indexOf(e._rememberCurrentClassStyle)?e._rememberCurrentClassStyle:t[0]:null},this.addClassToStyle=function(e,t,n,s,l){t?(s&&t.removeClass(s),t.addClass(n),k(e,null,t,l)):(s&&U(e,s),O(e,n),b(e))},this.removeClassFromStyle=function(e,t,n,s){t?(t.removeClass(n),k(e,null,t,s)):(U(e,n),b(e))},this.class_setter_info=null,function(e,t){return(t=t||e.getAttribute(g))&&t.trim().length||e.hasAttribute(w)?w:"class"}),j=(this.getAttributeForInlineClasses=N,function(e){return splitBracketsAware(e.getAttr(N(e))||""," ").filter(function(e){return 0<e.length})}),B=function(e,t){var n=N(e);t.length?e.setAttr(n,t.join(" ")):e.removeAttribute(n)},O=this.addInlineClass=function(e,t){var n=j(e);n.indexOf(t)<0&&n.push(t),B(e,n)},U=this.removeInlineClass=function(e,t){var n=j(e),s=n.indexOf(t);0<=s&&n.splice(s,1),B(e,n)},L=(this.hasClass=function(e,t){var n,s;return this.class_setter_info=null,!("string"!=typeof t||!t.length)&&(n=I(t),P?(n.normal=l(n.normal),!!P.hasClass(n.normal)||(P.hasClass(n.important)?(this.class_setter_info={important:!0},!0):void 0)):(s=N(e),e.getAttr(s)?0<=(s=" "+(e.getAttribute(s)||"")+" ").indexOf(" "+n.normal+" ")||(0<=s.indexOf(" "+n.important+" ")?(this.class_setter_info={important:!0},!0):void 0):!!e.hasClass(n.normal)||(e.hasClass(n.important)?(this.class_setter_info={important:!0},!0):void 0)))},this.canAddClass=async function(e,t,n){return!((n=n||P)&&n.component&&await this.wouldComponentCauseError(n,[t])&&(pinegrow.showAlert(`<p>The class <code>${t}</code> is not a valid Tailwind CSS class. You can't add this class to style <code>${n.getSelector()}</code> because it would break the Tailwind compilation.</p><p>You can add the class directly to the element, as an inline class.</p>`,"Not a Tailwind CSS class",null,"Ok"),1))},this.addClass=function(e,t,n){"string"==typeof t&&t.length&&(P?(t=l(t),P.addClass(t),k(a(e))):e.getAttr(g)?(O(e,t),k(e,!0)):e.addClass(t,n))},this.removeClass=function(e,t,n){var s;"string"==typeof t&&t.length&&(s=I(t),P?(s.normal=l(s.normal),P.removeClass(s.normal),P.removeClass(s.important),k(a(e))):e.getAttr(g)?(U(e,s.normal),U(e,s.important),k(e,!0)):(e.removeClass(s.normal,n),e.removeClass(s.important,n)))},this.canRemoveClass=function(e,t){return!0},this.getClasses=function(e){return P?P.getClasses():j(e)},this.addStateOnStyle=function(n,s){pinegrow.requireProjectDB(function(t){pinegrow.makeChanges(n.db_node.getPage(),"Add state to "+n.display_name,function(){n.addForcedState(s);var e=new PgCollection(n.db_node);t.changed(e,{source:"class_styles"}),k(null,!1,n)}),u()})},function(e){return e&&e.classSetter===m}),M=function(t){function n(e){t&&e.children.length&&G(e.children),e.children.forEach(function(e){s.push(e),n(e)})}var s=[],l=[];x={},A.forEach(function(e){null===e.parent&&null===e.scopeParent&&l.push(e),x[e.key]=e}),t&&G(l),l.forEach(function(e){null===e.parent&&null===e.scopeParent&&(s.push(e),n(e))}),A=s};this.expandStyle=function(e,t,n){e.setExpanded(t),h.is_changed=!0,u(),_([e],!0,n)},this.lockStyle=function(e,t,n){e.setLocked(t),h.is_changed=!0,u(),_([e],!0,n)},this.expandAll=function(t,e){this.getStyles().forEach(function(e){e.setExpanded(t)}),this.setLastExpanded(t),h.is_changed=!0,u(),_(this.getStyles(),!0,e)},this.lockAll=function(t,e){this.getStyles().forEach(function(e){e.setLocked(t)}),this.setLastLocked(t),h.is_changed=!0,u(),_(this.getStyles(),!0,e)},this.showStyleTypeDialog=async function(){return new Promise(function(e){pinegrow.showAlert(`<ul>
<li style="margin-bottom: 10px;"><span style="background-color: var(--pg-blue);
    color: #fff;
    border-radius: 2px;
    display: inline-block;
    padding: 2px 6px;">Component styles</span> - Create Tailwind CSS components that compile into one or more CSS rules targeting elements with CSS selectors (for example, <code>h1</code> affects all H1 elements in the project). Choose Component styles if you want to style your project without using Tailwind CSS classes directly on HTML elements.</li>
    <li><span style="background-color: var(--pg-orange);
    color: #fff;
    border-radius: 2px;
    display: inline-block;
    padding: 2px 6px;">Class styles</span> - Create styles that set their classes directly to the class attribute of every element that uses the style. Choose Class styles if you want to have Tailwind CSS classes directly on HTML elements.</li>
</ul><p>You can change this setting at any time. <a href="https://pinegrow.com/docs/tailwind/class-styles/" class="external">Learn more about styles.</a></p>`,"What type of styles would you like to use in this project?","Cancel","Component styles",function(){e(null)},function(){e(!0)},"Class styles",function(){e(!1)}).find(".modal-footer a.btn-primary").css({backgroundColor:"var(--pg-orange)"})})},this.showStyleContextMenu=function(s,e,t,n,l){function o(e){pinegrow.classStyles.deleteStyle(s,e),l&&l()}var a=pinegrow.selectedElements.getLastSelected(),i=[],r=(a&&(pinegrow.classStyles.isStyleOnPgel(a,s)?(i.push({type:"header",label:"Remove style"}),i.push({label:"Remove from selected element",action:function(){pinegrow.classStyles.removeStyleFromPgel(s),l&&l()}}),i.push({label:"Remove &amp; leave classes on "+pinegrow.selectedElements.getName(),action:function(){pinegrow.classStyles.removeStyleFromPgel(s,!0),l&&l()}})):(i.push({type:"header",label:"Add style"}),i.push({label:"Add to selected element",action:function(){pinegrow.classStyles.assignStyle(s),l&&l()}}),s.component||i.push({label:"Add to selected element &amp; keep inline",action:function(){pinegrow.classStyles.assignStyle(s,null,!0),l&&l()}}))),s.component||i.push({label:"Add style to all matching elements",action:function(){var e=pinegrow.getSelectedPage();e?pinegrow.classStyles.addStyleToMatchingElements(s,e):pinegrow.showQuickError("Please open a page first."),l&&l()}}),i.push({type:"divider"}),i.push({label:"Edit as code...",action:function(){pinegrow.classStyles.editStyleSource(s,e)}}),i.push({type:"divider"}),new PgApi),r=((i=i.concat(r.twGetMenuActionsFor(a,s,null,""))).push({type:"divider"}),i.push({label:"Duplicate style...",action:function(){var t=0===s.children.length?"without_substyles":null,n=null===s.parent?"as_top":null,e={};t||(e.mode_with={name:"Duplicate",type:"select",value:"with_substyles",show_empty:!1,options:[{key:"with_substyles",name:"with sub-styles"},{key:"without_substyles",name:`without sub-styles`}]}),n||(e.mode_as={name:"Duplicate as",type:"select",value:"as_substyle",show_empty:!1,options:[{key:"as_substyle",name:`Sub-style of `+s.parent.display_name},{key:"as_top",name:"Top level style"}]}),e.old_name={name:"Current name",type:"displayhtmlwithlabel",html:s.name},e.name={name:"New name",validate:function(e,t,n){return pinegrow.classStyles.validateNameForANewStyle(n)}},pinegrow.showQuickDialog(`Duplicate style `+s.display_name,"Style information",`<p>Enter the new name for the new style:</p>`,e,"Cancel","Duplicate",null,function(e){t=e.mode_with||t,n=e.mode_as||n,pinegrow.classStyles.duplicateStyle(s,e.name,t,n,function(){l&&l()})})}}),i.push({label:"Rename style...",action:function(){pinegrow.showQuickDialog(`Rename style `+s.display_name,"Style information",`<p>Enter the new name for the style and click on Rename &amp; Update.</p><p>Please note that all changed files in the project will be saved. This operation can not be undone.</p>`,{old_name:{name:"Current name",type:"displayhtmlwithlabel",html:s.name},name:{name:"New name",validate:function(e,t,n){return pinegrow.classStyles.validateNameForANewStyle(n,s)}}},"Cancel","Rename &amp; Update project",null,function(e){pinegrow.classStyles.renameStyle(s,e.name,function(){l&&l()})})}}),i.push({type:"divider"}),i.push({type:"header",label:"Delete style from the project"}),i.push({label:"Delete style",action:function(){o(!1)}}),s.component&&!1||i.push({label:"Delete style &amp; keep classes on elements",action:function(){o(!0)}}),new CrsaContextMenu(i,e));t?r.showAt(t.pageX,t.pageY):r.showForElement(e)},pinegrow.addEventHandler("on_can_make_change",function(e,t,n,s){return e&&e.getCurrentFrameworkHandlerReturnValue("on_can_make_change")?e.getCurrentFrameworkHandlerReturnValue("on_can_make_change"):L(e)&&P&&("add_class"===n||"remove_class"===n)&&P.locked?new PgEditException(`<p>The selected style <b>${P.name}</b> is locked.</p><p>Unlock it in the Style manager or edit the classes directly in the Properties panel.</p>`,"This style is locked"):void 0}),pinegrow.addEventHandler("on_element_selected",function(e,t,n){var s,l,o,a,i,r,c;L(e)&&(c=r=i=a=null,(n=(e=t)&&((!e._rememberCurrentClassStyle||"direct"!==e._rememberCurrentClassStyle)&&(l=(s=m.getStylesForPgelIncludingSubelements(e)).map(function(e){return e.style})).length?(o=l.indexOf(e._rememberCurrentClassStyle),e._rememberCurrentClassStyle&&0<=o?(a=e._rememberCurrentClassStyle,i=s[o].state,r=s[o].all_states,c=s[o]?.state_whole,(o=e._rememberCurrentClassStyleContext||null)&&0<=r.indexOf(o.state)&&(i=o.state,c=o.state)):(a=l[0],i=s[0].state,r=s[0].all_states,c=s[0]?.state_whole)):a=null,a)?{style:a,state:i,state_whole:c,all_states:r}:null)?m.setCurrentStyle(n.style,!0,"element_selected",n):m.setCurrentStyle(null,!0,"element_selected"))}),pinegrow.addEventHandler("on_before_changes_done",function(e,t,n){c&&o(null,c),c=!1}),pinegrow.addEventHandler("on_project_loaded",function(e,t){t.requireDB(function(e){h=e,s(),m.classValidator=new PgTailwindValidator;var t=pinegrow.getCurrentProjectInfo(),t=(n=m.canUseComponents()&&"1"===t.getSetting("class-styles-components",A.length?"0":"1"),{});!m.canUseComponents(t)&&m.getComponentStyles().length&&pinegrow.showAlert(`<p>Component styles are defined but they can not be used in this project. ${t.reason}</p>`,"Component styles will be ignored",null,"Got it")},!1)}),pinegrow.addEventHandler("on_project_closed",function(e,t){A=[],M(),m.classValidator=null,pinegrow.dispatchEvent("on_class_styles_updated_from_db")}),pinegrow.addEventHandler("on_projectdb_changed",function(e,t,n){n&&"undo"===n.source&&s()}),pinegrow.addEventHandler("on_page_parsed_in_proxy",function(e){H()&&R(e)}),pinegrow.addEventHandler("on_dm_get_css",function(e,t,n){if("rules"===t&&H()){for(var s,l,o=[],a=0;a<A.length;a++)A[a].component&&(s=A[a].classes).length&&((l=A[a].isClassSelector())&&(n.additional_classes+=l+" "),l=`
    ${A[a].getSelector()} {
        @apply ${s.join(" ")};
    }`,o.push(l));o.length&&(n.css+=`
                    
/* Class styles components */
@layer components {
${o.join("\n")}
}                    
`)}})}window.PgClassStyle=function(e,t){this.children=[],this.parent=null,this.scopeParent=null,this.level=0,this.expanded=!1,this.locked=!1,this.count=0,this.deleted=!1,this.component=!1,this.force_states=[],e instanceof pgParserNode?(this.db_node=e,this.updateFromNode()):(this.name=this.display_name=e,this.key=t?this.name:W(this.name),this.classes=[],this.db_node=null)},PgClassStyle.prototype.updateFromNode=function(){this.key=this.db_node.getAttr("key"),this.name=this.display_name=this.db_node.getAttr("name"),this.classes=splitBracketsAware(this.db_node.getAttr("class")||""," ").filter(function(e){return 0<e.length}),this.expanded=this.db_node.hasAttribute("expanded"),this.locked=this.db_node.hasAttribute("locked"),this.component=this.db_node.hasAttribute("component"),this.count=parseInt(this.db_node.getAttribute("count")||"0"),this.force_states=splitBracketsAware(this.db_node.getAttribute("states")||""," ").filter(function(e){return!!e})},PgClassStyle.prototype.updateToNode=function(e){this.db_node||(this.db_node=e.createNode("classstyle",{},!1)),this.db_node.setAttr("key",this.key),this.db_node.setAttr("name",this.name),this.db_node.setAttr("class",this.classes.join(" ")),this.expanded?this.db_node.setAttribute("expanded",null):this.db_node.removeAttribute("expanded"),this.locked?this.db_node.setAttribute("locked",null):this.db_node.removeAttribute("locked"),this.component?this.db_node.setAttribute("component",null):this.db_node.removeAttribute("component"),this.db_node.setAttribute("count",this.count),this.db_node.setAttribute("states",this.force_states.join(" "))},PgClassStyle.prototype.addForcedState=function(e){e.endsWith(":")&&(e=e.substring(0,e.length-1)),this.force_states.indexOf(e)<0&&"all"!==e&&(this.force_states.push(e),this.db_node)&&this.db_node.setAttribute("states",this.force_states.join(" "))},PgClassStyle.prototype.removeForcedState=function(e){e.endsWith(":")&&(e=e.substring(0,e.length-1));var t=this.force_states.indexOf(e);0<=t&&(this.force_states.splice(t,1),this.db_node)&&this.db_node.setAttribute("states",this.force_states.join(" "))},PgClassStyle.prototype.getForcedStates=function(){return this.force_states},PgClassStyle.prototype.isMatchForPgel=function(e){return e.is(this.getSelector())},PgClassStyle.prototype.doesPgelHasThisStyle=function(e){return this.component?this.isMatchForPgel(e):0<=pinegrow.classStyles.getStylesForPgel(e,!0).indexOf(this)},PgClassStyle.prototype.getSelector=function(){return this.key},PgClassStyle.prototype.isClassSelector=function(){return!!this.key.match(/^\.[^, \#\[\:]+$/)&&this.key.substring(1)},PgClassStyle.prototype.destroy=function(){this.db_node=null},PgClassStyle.prototype.setParent=function(e,t){(this.parent=e)&&(e.children.push(this),t)&&G(e.children)},PgClassStyle.prototype.setScopeParent=function(e,t){(this.scopeParent=e)&&(e.children.push(this),t)&&G(e.children)},PgClassStyle.prototype.updateKeyAndDisplayName=function(){this.key=this.component?this.name:W(this.name),this.display_name=this.name,this.parent?(this.display_name=this.parent.display_name+" - "+this.name,this.key=this.parent.key+"."+this.key):this.scopeParent&&(this.display_name=this.scopeParent.display_name+" &gt; "+this.name,this.key=this.scopeParent.key+":"+this.key)},PgClassStyle.prototype.getDisplayName=function(){return this.display_name||this.name||this.key},PgClassStyle.prototype.remove=function(e){var t;this.parent&&0<=(t=this.parent.children.indexOf(this))&&(this.parent.children.splice(t,1),this.parent=null),this.db_node.remove(),this.deleted=!0},PgClassStyle.prototype.getClasses=function(){return this.classes},PgClassStyle.prototype.hasClass=function(e){return 0<=this.classes.indexOf(e)},PgClassStyle.prototype.addClass=function(e,t){this.classes.indexOf(e)<0&&this.classes.push(e);var n=q(e);n.prefix&&this.removeForcedState(n.prefix),this.db_node&&!t&&this.db_node.setAttribute("class",this.classes.join(" "))},PgClassStyle.prototype.setClasses=function(e){var n=this;this.classes=e,this.classes.forEach(function(e){var t=q(e);t.prefix&&n.removeForcedState(t.prefix)}),this.db_node&&this.db_node.setAttribute("class",this.classes.join(" "))},PgClassStyle.prototype.removeClass=function(e){var t=this.classes.indexOf(e);0<=t&&this.classes.splice(t,1),this.db_node&&this.db_node.setAttribute("class",this.classes.join(" "))},PgClassStyle.prototype.setExpanded=function(e){this.expanded=e,this.db_node.withoutEvents(function(){e?this.setAttribute("expanded",null):this.removeAttribute("expanded")})},PgClassStyle.prototype.setLocked=function(e){this.locked=e,this.db_node.withoutEvents(function(){e?this.setAttribute("locked",null):this.removeAttribute("locked")})},PgClassStyle.prototype.setComponent=function(e){this.component=e,this.db_node.withoutEvents(function(){e?this.setAttribute("component",null):this.removeAttribute("component")})},PgClassStyle.prototype.setUsageCount=function(e){var t=this;this.count=e,this.db_node.withoutEvents(function(){this.setAttribute("count",t.count)})},PgClassStyle.prototype.hasVariant=function(e){for(var t=0;t<this.classes.length;t++)if(q(this.classes[t]).prefix===e)return!0;return!1},PgClassStyle.prototype.getAllSubelementSelectors=function(e){for(var t=[],n=/^\[\&(.*)\]$/,s="-###-",l={},o=0;o<this.classes.length;o++){var a,i=splitBracketsAware(this.classes[o],":"),r="";if(1<i.length)for(var c=0;c<i.length-1;c++){var d=i[c].match(n);d&&(r.length&&(r+=" "),r+=d[1].replace(/\\\_/g,s).replace(/_/g," ").replace(/\-\#\#\#\-/g,"_"))}r.length&&(i.pop(),l[a=i.join(":")]||(t.push({sel:r,state:a}),l[a]=!0))}return t};var z="class-styles-deep";window.PgClassStylesView=function(){function t(e){pinegrow.classStyles.expandAll(e),a.show(),v()}function n(e){pinegrow.classStyles.lockAll(e),a.show()}var a=this,e=(this.$element=$('<div class="pg-dm-style-list"></div>'),$('<div class="pg-dm-style-list-header"></div>').appendTo(this.$element),new PgSearchBox({toolbar_on:!0,placeholder:"search",placeholder_active:"search by style name"})),l=null,s=(e.onSearch=function(e){l=e?new RegExp(escapeRegExp(e),"i"):null,a.show()},this.toolbar=e.getToolbar()),o=(s.addSection("settings"),new PgButtonToolbarItem("icon-down","Style type, lock, expand styles, update project..."));s.addItem("settings",o),o.onClick=function(){var e=[{type:"header",label:"Expand / collapse styles"},{label:"Expand all",action:function(){t(!0)}},{label:"Collapse all",action:function(){t(!1)}},{type:"divider"},{type:"header",label:"Lock / unlock styles"},{label:"Lock all",action:function(){n(!0)}},{label:"Unlock all",action:function(){n(!1)}},{type:"divider"},{type:"header",label:"Update"},{label:"Update usage counts",action:function(){pinegrow.classStyles.updateUsageCounts(function(){a.show()})}}];return pinegrow.classStyles.getNonComponentStyles().length&&e.push({label:"Update whole project & save changes",action:function(){pinegrow.classStyles.updateProject(function(){a.show()})}}),new CrsaContextMenu(e,this.$element).showForElement(this.$element),!1},e.$element.appendTo(this.$element);function i(e,t){var o=!1;t&&1===t.length?h.whenVisible(function(){var s=pinegrow.classStyles.getCurrentStyle(),l=null,e=pinegrow.selectedElements.getLastSelected();e&&(l=pinegrow.classStyles.getStylesForPgel(e)),t.forEach(function(e){var t,n=w(e);n&&(e.deleted?n.parentNode&&n.parentNode.removeChild(n):(t=f(e,s===e,!!l&&0<=l.indexOf(e)),n.outerHTML=t,o=!0))}),o||a.show()},"updateSingleClassStyle"):a.show()}function r(e,t){h.whenVisible(function(){S(),C(),v(t)},"setActiveStyle",1)}function c(e){e&&(g=e.getShowNameClassesFilter(),y.run("updateAfterFrameworksChanged",function(){a.show()},500))}function d(e){h.whenVisible(function(){S(),C()},"updateUsed")}(new PgSearchBoxSpacer).$element.appendTo(this.$element);var p=new PgPanelNotice,u=(p.$element.appendTo(this.$element),$('<div class="pg-dm-style-list-items"></div>').appendTo(this.$element)),h=this.view=new PgUIView(this.$element,"classstyles"),g=(h.tabIcon="icon-classes",new WeakMap,null),y=new PgDelayedTasks,f=(u.on("click",".name",function(e){e.preventDefault();var t=$(this).closest(".pg-dm-style-list-item").attr("data-key"),t=pinegrow.classStyles.findStyleByKey(t),n=pinegrow.selectedElements.getLastSelected();n?0<=pinegrow.classStyles.getStylesForPgel(n).indexOf(t)?(pinegrow.classStyles.removeStyleFromPgel(t),pinegrow.showQuickMessage(`Style <b>${t.display_name}</b> was removed from selected elements.`)):(pinegrow.classStyles.assignStyle(t),pinegrow.showQuickMessage(`Style <b>${t.display_name}</b> was added to selected elements.`)):pinegrow.showQuickError("Please select the element first.")}),u.on("contextmenu",".pg-dm-style-list-item",function(e){e.preventDefault();var t=$(this).closest(".pg-dm-style-list-item").attr("data-key"),t=pinegrow.classStyles.findStyleByKey(t);return pinegrow.classStyles.showStyleContextMenu(t,$(e.target),e),!1}),u.on("click","i.open",function(e){e.preventDefault();var t=$(this).closest(".pg-dm-style-list-item"),n=t.attr("data-key"),n=pinegrow.classStyles.findStyleByKey(n);return pinegrow.classStyles.expandStyle(n,!0),t.addClass("open"),pinegrow.classStyles.setLastExpanded(!0),!1}),u.on("click","i.collapse",function(e){e.preventDefault();var t=$(this).closest(".pg-dm-style-list-item"),n=t.attr("data-key"),n=pinegrow.classStyles.findStyleByKey(n);return pinegrow.classStyles.expandStyle(n,!1),t.removeClass("open"),pinegrow.classStyles.setLastExpanded(!1),!1}),u.on("click","i.lock",function(e){e.preventDefault();var t=$(this).closest(".pg-dm-style-list-item"),n=t.attr("data-key"),n=pinegrow.classStyles.findStyleByKey(n),s=!n.locked;return pinegrow.classStyles.lockStyle(n,s),s?t.addClass("locked"):t.removeClass("locked"),pinegrow.showMode("Style is locked",s),pinegrow.classStyles.setLastLocked(s),!1}),u.on("click",".pg-tree-class",function(e){e.preventDefault();var t=$(this).closest(".pg-dm-style-list-item").attr("data-key"),t=pinegrow.classStyles.findStyleByKey(t),n=$(this).attr("data-class"),s=pinegrow.selectedElements.getLastSelected();return s?0<=pinegrow.classStyles.getStylesForPgel(s).indexOf(t)?pinegrow.dispatchEvent("on_class_style_property_clicked",s.getPage(),t,n):pinegrow.showQuickError(`Selected element does not have the style <b>${t.display_name}</b>.`):pinegrow.showQuickError("Select the element with this style first."),!1}),u.on("click",".count",function(e){e.preventDefault(),pinegrow.classStyles.updateUsageCounts(function(){a.show()})}),function(e,t,n){return`<div class="pg-dm-style-list-item${t?" active":""}${n?" used":""}${e.expanded?" open":""}${e.locked?" locked":""} level-${e.level} ${0<e.children.length?"has-kids":"no-kids"}" data-key="${e.key}" style="margin-left:${20*e.level}px;">${m(e)}</div>`}),m=function(e){var t,n="";return g?(t=g(e),n=(n=t.html).replace("ALT click","Click")):e.getClasses().forEach(function(e){n+=`<span class="pg-tree-class" data-class="${e}" title="Click to jump to property.">${e}</span>`}),`<div class="info"><span class="name" title="Click to add or remove from the selected element, right-click for options.">${e.scopeParent?"&gt; ":""}${e.name}</span><span class="count" title="Used ${e.count} times in the project. Click to update counts.">${e.count}</span><i class="lock icon icon-Lock_open" title="Unlock the style for editing."></i><i class="lock icon icon-Lock_closed" title="Lock the style."></i><i class="collapse-expand collapse icon icon-down"></i><i class="collapse-expand open icon icon-right"></i></div><div class="classes">${n}</div>`},w=function(e){return u.get(0).querySelector(`[data-key="${e.key}"]`)},S=(this.show=function(){h.whenVisible(function(){var t=pinegrow.classStyles.getCurrentStyle(),n=null,e=pinegrow.selectedElements.getLastSelected(),s=(e&&(n=pinegrow.classStyles.getStylesForPgel(e)),"");pinegrow.classStyles.getStyles().forEach(function(e){l&&!l.test(e.display_name)||(s+=f(e,t===e,!!n&&0<=n.indexOf(e)))}),(u.get(0).innerHTML=s)?p.show(null):p.show("No Styles are defined. Styles are a part of Tailwind Visual Editor and only work when a project is loaded.")}),h.clearWhenVisible("setActiveStyle"),h.clearWhenVisible("updateUsed"),h.clearWhenVisible("updateSingleClassStyle")},this.show(),function(){u.get(0).querySelectorAll(".pg-dm-style-list-item.used,.pg-dm-style-list-item.active").forEach(function(e){e.classList.remove("used"),e.classList.remove("active")})}),v=function(e){var t;e&&(t=w(e))&&(t=$(t),pgScrollToItemInContainer(t,t.parent()))},C=function(){var e=pinegrow.selectedElements.getLastSelected(),n=pinegrow.classStyles.getCurrentStyle();e&&pinegrow.classStyles.getStylesForPgel(e).forEach(function(e){var t=w(e);t&&(t.classList.add("used"),e===n)&&t.classList.add("active")})};pinegrow.addEventHandler("on_current_class_style_changed",r),pinegrow.addEventHandler("on_class_styles_changed",i),pinegrow.addEventHandler("on_page_frameworks_changed",c),pinegrow.addEventHandler("on_class_styles_updated_from_db",i),pinegrow.addEventHandler("on_selected_elements_changed",d),h.onDestroy=function(){pinegrow.removeEventHandler("on_current_class_style_changed",r),pinegrow.removeEventHandler("on_class_styles_changed",i),pinegrow.removeEventHandler("on_page_frameworks_changed",c),pinegrow.removeEventHandler("on_class_styles_updated_from_db",i),pinegrow.removeEventHandler("on_selected_elements_changed",d),y.destroy()}};class m{constructor(e,t,n,s){this.$element=$(`<div class="pg-dm-style-name-helper"><div class="component"><p>Enter a style CSS selector. Suggestions:</p></div><p class="type-info" style="margin-top: 10px;
    font-size: 11px;
    opacity: 0.75;
    border-top: 1px solid #ffffff63;
    padding-top: 10px;
}"></p></div>`),this.$component=this.$element.find(".component"),this.$list=$(`<table class="list"></table>`).appendTo(this.$component),this.pgel=e,this.$target=n,this.is_component=s,"1"===pinegrow.getSetting(z,"0")&&this.$element.append(`<p style="color:#ffaa50;">Caution: style will include classes for all sub-elements.</p>`);const l=this;this.$element.find(".type-info").on("click",".switch-type",function(e){e.preventDefault(),pinegrow.classStyles.setUsingComponents(!l.is_component)&&(l.is_component=!l.is_component,l.showTypeInfo(),l.onSwitchType(l.is_component))}),this.$list.on("click","[data-sel]",function(e){e.preventDefault();var t=this.getAttribute("data-sel");pinegrow.classStyles.findStyleByKey(t)?pinegrow.showQuickError(`Style <code>${t}</code> already exists.`):l.onSelected(t)}),this.$list.get(0).innerHTML=`<tr><td colspan="3">Checking classes...</td></tr>`,this.showTypeInfo(),this.$target.closest("body").append(this.$element),this.pos=new PgPositionNextTo$El(this.$element,this.$target,null,0,"down_no_resize"),this.dom_observer=setInterval(function(){l.$target.is(":visible")||l.destroy()},100)}onSwitchType(e){}showTypeInfo(){this.$element.find(".type-info").html(`Creating a ${this.is_component?"<b>Component style</b> that targets element with CSS selector":"<b>Class style</b> that sets classes directly on elements"}. <a href="#" class="switch-type">Switch to ${this.is_component?"Class style":"Component style"}.</a>`),this.is_component?this.$component.show():this.$component.hide()}updateList(){const t=this;var n=[],e=this.pgel,s=e.getAttribute("id"),l=(s&&n.push({sel:"#"+s,comment:`Elements with id `+s}),n.push({sel:e.tagName,comment:`All ${e.tagName} elements`}),0),s=(e.getClasses().forEach(function(e){!0!==t.valid_classes[e]&&++l<5&&n.push({sel:"."+e,comment:`All elements with the class `+e})}),n.map(function(e){return t.showSuggestion(e.sel,e.comment)}).join(""));this.$list.get(0).innerHTML=s}setValidClasses(e){this.valid_classes=e,this.updateList()}onSelected(e){}onUserValueChanged(e){const o=this;var a=[],t=(splitQuotesAware(e,",").forEach(function(e){if(e&&e.trim().length){for(var t,n,s="",l=splitQuotesAware(e," ");l.length;)(e="string"==typeof(e=l.pop())?e.trim():e).length&&(n=[],">"!==(t=o.pgel.parseSelector(e)).tag&&(t.tag?n.push(t.tag+" elements"):n.push("elements")),t.id&&n.push("with id "+t.id),t.classes&&(1===t.classes.length?n.push("with class "+t.classes[0]):n.push("with classes "+t.classes.join(", "))),t.attr)&&(t.attrValue?n.push(`with attribute ${t.attr} having value `+t.attrValue):n.push(`with attribute `+t.attr)),s+=n.join(" "),l.length&&(s+=" inside ");a.push(s)}}),"");a.length&&(t=a.join(", ")),this.$list.find("[data-user-val]").remove(),e&&!e.match(/^[\.\#\[\]\-\_]$/)&&(t=this.showSuggestion(e,t,!0),this.$list.prepend(t)),this.pos.reposition()}showSuggestion(e,t,n){var s=pinegrow.getSelectedPage().sourceNode.find(e);return pinegrow.classStyles.findStyleByKey(e)&&(t="This style already exists"),`<tr data-sel="${e}" ${n?"data-user-val":""}><td class="selector">${e}</td><td class="count">${s.length}</td><td class="comment">${t||""}</td></tr>`}destroy(){this.$element.remove(),this.pos.destroy(),clearInterval(this.dom_observer)}}$("body").one("pinegrow-ready",function(e,t){t.classStyles=new n})});